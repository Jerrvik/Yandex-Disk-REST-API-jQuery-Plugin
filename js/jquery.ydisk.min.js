/*! Yandex Disk REST API jQuery Plugin v1.0.2 https://andew.ru/ru/pages/page/yandex-disk-rest-api-jquery-plugin */
;(function(window,document,$,undefined){"use strict";var ydiskQueue=$({}),ajaxQueue=function(ajaxOpts){var jqXHR,dfd=$.Deferred(),promise=dfd.promise();function doRequest(next){jqXHR=$.ajax(ajaxOpts);jqXHR.done(dfd.resolve).fail(dfd.reject).then(next,next);};ydiskQueue.queue(doRequest);return promise;};$.fn.ydisk=function(options){options=$.extend(true,{onType:'click',url:'https://cloud-api.yandex.net:443/v1/disk/public/resources/download?public_key=',matcher:/(^.{0,15}yadi\.sk\/[\w]{1,5}\/[\w-]{1,32}$)/i,timeout:5000,async:true,afterReplace:false,loader:false,failed:false,replacer:{audio:'<audio id="{id}" class="ydisk-audio" controls src="{href}"{size}></audio>',video:'<video id="{id}" class="ydisk-video" controls src="{href}"{size}></video>',image:'<img id="{id}" class="ydisk-image" controls src="{href}"{size}>',dload:'<a id="{id}" class="ydisk-dload" download href="{href}">Download {html}</a>'}},options);$(this).on('onYdiskStart',function(e){var $this=$(this);var url=$this.attr('href')||'';url=(url.match(options.matcher)||[])[1];if(url){var fHtml=$this.html()||'';if(options.async!==false){options.async=true;};url=options.url+encodeURIComponent(url);if($.type(options.loader)==="string"){$this.append(options.loader);};ajaxQueue({url:url,async:options.async,timeout:options.timeout,success:function(data){var replacer,mediaType=function(url){url=url||'';url=url.match(/media_type\=([^\&]+)/i);if(url){return url[1]||'error';};return'error';};var type=mediaType(data.href);if($this.attr('download')){replacer=options.replacer.dload;}else{if(type==='audio'){replacer=options.replacer.audio;}else if(type==='video'){replacer=options.replacer.video;}else if(type==='image'){replacer=options.replacer.image;}else if(type==='compressed'){replacer=options.replacer.dload;}else{replacer=options.replacer.dload;};};if(replacer){var s='',w=parseInt($this.data('width')),h=parseInt($this.data('height')),id=$this.attr('id')||'ydisk-replaced-'+new Date().getTime();if($.isNumeric(w)&&$.isNumeric(h)){s=' width="'+w+'" height="'+h+'"';};replacer=replacer.replace(/\{id\}/g,id);replacer=replacer.replace(/\{href\}/g,data.href);replacer=replacer.replace(/\{size\}/g,s);replacer=replacer.replace(/\{html\}/g,fHtml);$this.replaceWith(replacer);if($.type(options.afterReplace)==='function'){try{options.afterReplace(id,type);}catch(e){}};if(typeof window[id]==='function'){try{window[id](id,type);}catch(e){}};};},error:function(){if($.type(options.loader)==="string"&&options.loader.length>0){$this.html(function(indx,oldHtml){return oldHtml.substr(0,oldHtml.length-options.loader.length);});};if($.type(options.failed)==="string"&&options.failed.length>0){$this.append(options.failed);};}});};});if(options.onType==='ready'){$(this).trigger('onYdiskStart');}else{$(this).one('click',function(e){e.preventDefault();$(this).trigger('onYdiskStart');});};return this;};}(window,document,jQuery));